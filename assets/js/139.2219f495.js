(window.webpackJsonp=window.webpackJsonp||[]).push([[139],{595:function(s,t,n){"use strict";n.r(t);var a=n(27),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"线程干扰"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#线程干扰"}},[s._v("#")]),s._v(" 线程干扰")]),s._v(" "),n("p",[s._v("考虑一个简单的类")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Counter")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" c "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("increment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        c"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("decrement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        c"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("Counter 被设计成使得每次调用 "),n("code",[s._v("increment")]),s._v(" 将添加 1 到 c，并且每次调用 "),n("code",[s._v("decrement")]),s._v(" 将从 c-1。\n然而，如果一个 "),n("code",[s._v("Counter")]),s._v(" 对象被多个线程引用，则线程之间的干扰可能会阻止这样的预期。")]),s._v(" "),n("p",[s._v("干扰发生在两个操作，运行在不同的线程，但作用与相同的数据。而且是交错调用。这以为者这两个操作由多个步骤组成，并且步骤序列重叠。")]),s._v(" "),n("p",[s._v("Counter 由于这两个操作都是单一的简单语句，因此可能不会对实例进行交错操作。然而，即使简单的语句也可以转换为虚拟机的多个步骤。\n我们不会检查虚拟机所采取的具体步骤，只要知道单个表达式 c++ 可以分解成以下三个步骤：")]),s._v(" "),n("ol",[n("li",[s._v("检索当前值 c")]),s._v(" "),n("li",[s._v("将检索到的值增加 1")]),s._v(" "),n("li",[s._v("将增加的值存储回来 c")])]),s._v(" "),n("p",[s._v("表达式 c-- 可以以相同的方式分解，除了第二步是减少而不是增加")]),s._v(" "),n("p",[s._v("假设线程 A 调用 "),n("code",[s._v("increment")]),s._v(" 的同一时间，线程 B 调用 "),n("code",[s._v("decrement")]),s._v("。如果初始值 c = 0。他们的交错操作可能遵循以下顺序：")]),s._v(" "),n("ol",[n("li",[s._v("线程 A：检索 c")]),s._v(" "),n("li",[s._v("线程 B：检索 c")]),s._v(" "),n("li",[s._v("线程 A：增加检索值；结果是 1")]),s._v(" "),n("li",[s._v("线程 B：减去检索值；结果是 -1")]),s._v(" "),n("li",[s._v("线程 A：将结果存储在 c 中，c 现在是 1")]),s._v(" "),n("li",[s._v("线程 B：将结果存储在 c 中，c 现在是 -1")])]),s._v(" "),n("p",[s._v("线程 A 的结构丢失，被线程 B 覆盖了。这种特定的交错只是一种可能性。在不同的情况下，线程 B 的结果可能会丢失，\n或则完全没有错误。因为他们是不可预测的，线程干扰的 bug 可能难以检测和修复。")])])}),[],!1,null,null,null);t.default=e.exports}}]);